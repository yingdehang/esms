<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>大额订单审核</title>
<link rel="stylesheet" th:href="@{/layui/css/layui.css}" />
<style type="text/css">
.photobox {
	width: 100%;
	height: auto;
}

.photobox img {
	float: left;
	width: 418px;
	height: 390px;
	margin: 10px;
}
</style>
</head>
<body>
	<div style="padding-bottom: 10px; border-bottom: 2px solid #5FB878">
		<h2>
			<a href="javascript:history.back(-1)">大额订单审核列表</a>>大额订单审核
		</h2>
	</div>
	<div id="audit" style="margin: 20px;">
		<button class="layui-btn" data-type="agree">同意</button>
		<button class="layui-btn" data-type="refuse">拒绝</button>
	</div>
	<form class="layui-form layui-form-pane" action="">
		<div class="layui-form-item">
			<label class="layui-form-label">店铺名称<input type="hidden"
				id="orderNumber" th:value="${orderInfo.orderNumber}" /><input
				type="hidden" id="orderId" th:value="${orderInfo.orderId}" /></label>
			<div class="layui-input-block">
				<input class="layui-input" type="text"
					th:value="${orderInfo.storeName}" autocomplete="off"
					disabled="disabled" />
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">商家信息</label>
			<div class="layui-input-block">
				<input class="layui-input" type="text"
					th:value="${orderInfo.storeInfo}" autocomplete="off"
					disabled="disabled" />
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">区域</label>
			<div class="layui-input-block">
				<input class="layui-input" type="text"
					th:value="${orderInfo.address}" autocomplete="off"
					disabled="disabled" />
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">区域站长</label>
			<div class="layui-input-block">
				<input class="layui-input" type="text"
					th:value="${orderInfo.zzInfo}" autocomplete="off"
					disabled="disabled" />
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">订单金额</label>
			<div class="layui-input-block">
				<input class="layui-input" type="text" th:value="${orderInfo.price}"
					autocomplete="off" disabled="disabled" />
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">买家手机号</label>
			<div class="layui-input-block">
				<input class="layui-input" type="text"
					th:value="${orderInfo.userPhone}" autocomplete="off"
					disabled="disabled" />
			</div>
		</div>
	</form>
	<fieldset class="layui-elem-field layui-field-title">
		<legend>交易凭证图片</legend>
	</fieldset>
	<div class="photobox">
		<img th:each="imglist:${orderInfo.photos}" alt="交易凭证图片"
			th:src="${imglist}" />
	</div>

	<script th:src="@{/layui/layui.js}"></script>
	<script type="text/javascript">
		layui.use(['table','element','layer'], function() {
			var table = layui.table;
			var $ = layui.jquery;
			var layer=layui.layer;
			var orderNumber=$("#orderNumber").val();
			var orderId=$("#orderId").val();
			var active = {
				agree: function(){
					$.post("/bigOrderAudit/queryBigState",{
						orderId:orderId
					},function(d){
						if(d=="ORDER_STATE_PAY"){
							$.post("/bigOrderAudit/updateBigOrderState",{
								orderNumber:orderNumber,
								bigState:"2"
							},function(d){
								if(d>0){
									window.location.href="/bigOrderAudit/toBigOrderAuditListHtml";
								}else{
									layer.msg("操作失败！");
								}
							});
						}else{
							layer.msg("该订单状态已改变，无法做审核操作");
						}
					});
				},
				refuse:function(){
					layer.prompt({
				        formType: 2
				        ,title: '请输入拒绝理由'
				      }, function(value, index){
				    	  $.post("/bigOrderAudit/queryBigState",{
								orderId:orderId
							},function(d){
								if(d=="ORDER_STATE_PAY"){
									$.post("/bigOrderAudit/updateBigOrderState",{
										orderNumber:orderNumber,
										bigState:"3",
										content:value
									},function(d){
										if(d>0){
											window.location.href="/bigOrderAudit/toBigOrderAuditListHtml"
										}else{
											layer.close(index);
											layer.msg("操作失败！");
										}
									});
								}else{
									layer.msg("该订单状态已改变，无法做审核操作");
								}
							});
				      });
				}
			};
			<!-- 监听搜索按钮 -->
			$('#audit .layui-btn').on('click', function(){
				var type = $(this).data('type');
				active[type] ? active[type].call(this) : '';
			});
		});
	</script>
</body>
</html>